<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenZWave Library: cpp/src/Driver.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="image003.gif"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenZWave Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">cpp/src/Driver.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">//  Driver.h</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//  Communicates with a Z-Wave network</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">//  Copyright (c) 2010 Mal Lansell &lt;openzwave@lansell.org&gt;</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">//  SOFTWARE NOTICE AND LICENSE</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">//  This file is part of OpenZWave.</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//  OpenZWave is free software: you can redistribute it and/or modify</span>
<a name="l00014"></a>00014 <span class="comment">//  it under the terms of the GNU Lesser General Public License as published</span>
<a name="l00015"></a>00015 <span class="comment">//  by the Free Software Foundation, either version 3 of the License,</span>
<a name="l00016"></a>00016 <span class="comment">//  or (at your option) any later version.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">//  OpenZWave is distributed in the hope that it will be useful,</span>
<a name="l00019"></a>00019 <span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00020"></a>00020 <span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00021"></a>00021 <span class="comment">//  GNU Lesser General Public License for more details.</span>
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a>00023 <span class="comment">//  You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00024"></a>00024 <span class="comment">//  along with OpenZWave.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef _Driver_H</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define _Driver_H</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;Defs.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;ValueID.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;Node.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;Event.h&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;Mutex.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;TimeStamp.h&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">namespace </span>OpenZWave
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     <span class="keyword">class </span>Msg;
<a name="l00045"></a>00045     <span class="keyword">class </span>Value;
<a name="l00046"></a>00046     <span class="keyword">class </span>Event;
<a name="l00047"></a>00047     <span class="keyword">class </span>Mutex;
<a name="l00048"></a>00048     <span class="keyword">class </span>Controller;
<a name="l00049"></a>00049     <span class="keyword">class </span>Thread;
<a name="l00050"></a>00050     <span class="keyword">class </span>ControllerReplication;
<a name="l00051"></a>00051     <span class="keyword">class </span>Notification;
<a name="l00052"></a>00052 
<a name="l00056"></a><a class="code" href="classOpenZWave_1_1Driver.html">00056</a>     <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Driver.html" title="The Driver class handles communication between OpenZWave and a device attached via a serial port (typ...">Driver</a>
<a name="l00057"></a>00057     {
<a name="l00058"></a>00058         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Manager.html" title="The main public interface to OpenZWave.">Manager</a>;
<a name="l00059"></a>00059         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Node.html" title="The Node class describes a Z-Wave node object...typically a device on the Z-Wave network.">Node</a>;
<a name="l00060"></a>00060         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Group.html" title="Manages a group of devices (various nodes associated with each other).">Group</a>;
<a name="l00061"></a>00061         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1CommandClass.html" title="Base class for all Z-Wave command classes.">CommandClass</a>;
<a name="l00062"></a>00062         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1ControllerReplication.html" title="Implements COMMAND_CLASS_CONTROLLER_REPLICATION (0x21), a Z-Wave device command class.">ControllerReplication</a>;
<a name="l00063"></a>00063         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Value.html" title="Base class for values associated with a node.">Value</a>;
<a name="l00064"></a>00064         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1ValueStore.html" title="Container that holds all of the values associated with a given node.">ValueStore</a>;
<a name="l00065"></a>00065         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1ValueButton.html" title="Button value ???.">ValueButton</a>;
<a name="l00066"></a>00066         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Association.html" title="Implements COMMAND_CLASS_ASSOCIATION (0x85), a Z-Wave device command class.">Association</a>;
<a name="l00067"></a>00067         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1Basic.html" title="Implements COMMAND_CLASS_BASIC (0x20), a Z-Wave device command class.">Basic</a>;
<a name="l00068"></a>00068         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1ManufacturerSpecific.html" title="Implements COMMAND_CLASS_MANUFACTURER_SPECIFIC (0x72), a Z-Wave device command class.">ManufacturerSpecific</a>;
<a name="l00069"></a>00069         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1NodeNaming.html" title="Implements COMMAND_CLASS_NODE_NAMING (0x77), a Z-Wave device command class.">NodeNaming</a>;
<a name="l00070"></a>00070         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1NoOperation.html" title="Implements COMMAND_CLASS_NO_OPERATION (0x00), a Z-Wave device command class.">NoOperation</a>;
<a name="l00071"></a>00071         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1SceneActivation.html" title="Implements COMMAND_CLASS_SCENEACTIVATION (0x2B), a Z-Wave device command class.">SceneActivation</a>;
<a name="l00072"></a>00072         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOpenZWave_1_1WakeUp.html" title="Implements COMMAND_CLASS_WAKE_UP (0x84), a Z-Wave device command class.">WakeUp</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00075"></a>00075     <span class="comment">//  Controller Interfaces</span>
<a name="l00076"></a>00076     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00077"></a>00077     <span class="keyword">public</span>:
<a name="l00078"></a>00078         <span class="keyword">enum</span> ControllerInterface
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080             ControllerInterface_Unknown = 0,
<a name="l00081"></a>00081             ControllerInterface_Serial,
<a name="l00082"></a>00082             ControllerInterface_Hid
<a name="l00083"></a>00083         };
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00086"></a>00086     <span class="comment">// Construction / Destruction</span>
<a name="l00087"></a>00087     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00088"></a>00088     <span class="keyword">private</span>:
<a name="l00092"></a>00092         <a class="code" href="classOpenZWave_1_1Driver.html" title="The Driver class handles communication between OpenZWave and a device attached via a serial port (typ...">Driver</a>( <span class="keywordtype">string</span> <span class="keyword">const</span>&amp; _controllerPath, ControllerInterface <span class="keyword">const</span>&amp; _interface );
<a name="l00097"></a>00097         <span class="keyword">virtual</span> ~<a class="code" href="classOpenZWave_1_1Driver.html" title="The Driver class handles communication between OpenZWave and a device attached via a serial port (typ...">Driver</a>();
<a name="l00098"></a>00098 
<a name="l00102"></a>00102         <span class="keywordtype">void</span> Start();
<a name="l00106"></a>00106         <span class="keyword">static</span> <span class="keywordtype">void</span> DriverThreadEntryPoint( <a class="code" href="classOpenZWave_1_1Event.html" title="Platform-independent definition of event objects.">Event</a>* _exitEvent, <span class="keywordtype">void</span>* _context );
<a name="l00125"></a>00125         <span class="keywordtype">void</span> DriverThreadProc( <a class="code" href="classOpenZWave_1_1Event.html" title="Platform-independent definition of event objects.">Event</a>* _exitEvent );
<a name="l00139"></a>00139         <span class="keywordtype">bool</span> Init( uint32 _attempts );
<a name="l00140"></a>00140 
<a name="l00145"></a>00145         <span class="keywordtype">void</span> RemoveQueues( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <a class="code" href="classOpenZWave_1_1Thread.html" title="Implements a platform-independent thread management class.">Thread</a>*                 m_driverThread;         
<a name="l00148"></a>00148         <span class="keywordtype">bool</span>                    m_exit;                 
<a name="l00149"></a>00149         <span class="keywordtype">bool</span>                    m_init;                 
<a name="l00150"></a>00150         <span class="keywordtype">bool</span>                    m_awakeNodesQueried;    
<a name="l00151"></a>00151         <span class="keywordtype">bool</span>                    m_allNodesQueried;      
<a name="l00152"></a>00152         <span class="keywordtype">bool</span>                    m_notifytransactions; 
<a name="l00153"></a>00153         <a class="code" href="classOpenZWave_1_1TimeStamp.html" title="Implements a platform-independent TimeStamp.">TimeStamp</a>               m_startTime;            
<a name="l00155"></a>00155     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00156"></a>00156     <span class="comment">//  Configuration</span>
<a name="l00157"></a>00157     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00158"></a>00158     <span class="keyword">private</span>:
<a name="l00159"></a>00159         <span class="keywordtype">void</span> RequestConfig();                           <span class="comment">// Get the network configuration from the Z-Wave network</span>
<a name="l00160"></a>00160         <span class="keywordtype">bool</span> ReadConfig();                              <span class="comment">// Read the configuration from a file</span>
<a name="l00161"></a>00161         <span class="keywordtype">void</span> WriteConfig();                             <span class="comment">// Save the configuration to a file</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00164"></a>00164     <span class="comment">//  Controller</span>
<a name="l00165"></a>00165     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00166"></a>00166     <span class="keyword">private</span>:
<a name="l00167"></a>00167         <span class="comment">// Controller Capabilities (return in FUNC_ID_ZW_GET_CONTROLLER_CAPABILITIES)</span>
<a name="l00168"></a>00168         <span class="keyword">enum</span>
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170             ControllerCaps_Secondary    = 0x01,     
<a name="l00171"></a>00171             ControllerCaps_OnOtherNetwork   = 0x02,     
<a name="l00172"></a>00172             ControllerCaps_SIS      = 0x04,     
<a name="l00173"></a>00173             ControllerCaps_RealPrimary  = 0x08,     
<a name="l00174"></a>00174             ControllerCaps_SUC      = 0x10      
<a name="l00175"></a>00175         };
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="comment">// Init Capabilities (return in FUNC_ID_SERIAL_API_GET_INIT_DATA)</span>
<a name="l00178"></a>00178         <span class="keyword">enum</span>
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180             InitCaps_Slave                  = 0x01,     
<a name="l00181"></a>00181             InitCaps_TimerSupport               = 0x02,     
<a name="l00182"></a>00182             InitCaps_Secondary              = 0x04,     
<a name="l00183"></a>00183             InitCaps_SUC                    = 0x08      
<a name="l00184"></a>00184         };
<a name="l00185"></a>00185 
<a name="l00186"></a>00186         <span class="keywordtype">bool</span> IsPrimaryController()<span class="keyword">const</span>{ <span class="keywordflow">return</span> ((m_initCaps &amp; InitCaps_Secondary) == 0); }
<a name="l00187"></a>00187         <span class="keywordtype">bool</span> IsStaticUpdateController()<span class="keyword">const</span>{ <span class="keywordflow">return</span> ((m_initCaps &amp; InitCaps_SUC) != 0); }
<a name="l00188"></a>00188         <span class="keywordtype">bool</span> IsBridgeController()<span class="keyword">const</span>{ <span class="keywordflow">return</span> (m_libraryType == 7); }
<a name="l00189"></a>00189         <span class="keywordtype">bool</span> IsInclusionController()<span class="keyword">const</span>{ <span class="keywordflow">return</span> ((m_controllerCaps &amp; ControllerCaps_SIS) != 0); }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         uint32 GetHomeId()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_homeId; }
<a name="l00193"></a>00193         uint8 GetNodeId()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_nodeId; }
<a name="l00194"></a>00194         uint8 GetSUCNodeId()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_SUCNodeId; }
<a name="l00195"></a>00195         uint16 GetManufacturerId()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_manufacturerId; }
<a name="l00196"></a>00196         uint16 GetProductType()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_productType; }
<a name="l00197"></a>00197         uint16 GetProductId()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_productId; }
<a name="l00198"></a>00198         <span class="keywordtype">string</span> GetControllerPath()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_controllerPath; }
<a name="l00199"></a>00199         ControllerInterface GetControllerInterfaceType()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_controllerInterfaceType; }
<a name="l00200"></a>00200         <span class="keywordtype">string</span> GetLibraryVersion()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_libraryVersion; }
<a name="l00201"></a>00201         <span class="keywordtype">string</span> GetLibraryTypeName()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_libraryTypeName; }
<a name="l00202"></a>00202         int32 GetSendQueueCount()<span class="keyword">const</span>
<a name="l00203"></a>00203 <span class="keyword">        </span>{
<a name="l00204"></a>00204             int32 count = 0;
<a name="l00205"></a>00205             <span class="keywordflow">for</span>( int32 i=0; i&lt;MsgQueue_Count; ++i )
<a name="l00206"></a>00206             {
<a name="l00207"></a>00207                 count += m_msgQueue[i].size();
<a name="l00208"></a>00208             }
<a name="l00209"></a>00209             <span class="keywordflow">return</span> count; 
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00221"></a>00221         <a class="code" href="classOpenZWave_1_1Node.html" title="The Node class describes a Z-Wave node object...typically a device on the Z-Wave network.">Node</a>* GetNodeUnsafe( uint8 _nodeId );
<a name="l00231"></a>00231         <a class="code" href="classOpenZWave_1_1Node.html" title="The Node class describes a Z-Wave node object...typically a device on the Z-Wave network.">Node</a>* GetNode( uint8 _nodeId );
<a name="l00235"></a>00235         <span class="keywordtype">void</span> LockNodes();
<a name="l00239"></a>00239         <span class="keywordtype">void</span> ReleaseNodes();
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         ControllerInterface         m_controllerInterfaceType;                      <span class="comment">// Specifies the controller&#39;s hardware interface</span>
<a name="l00242"></a>00242         <span class="keywordtype">string</span>                  m_controllerPath;                           <span class="comment">// name or path used to open the controller hardware.</span>
<a name="l00243"></a>00243         <a class="code" href="classOpenZWave_1_1Controller.html">Controller</a>*             m_controller;                               <span class="comment">// Handles communications with the controller hardware.</span>
<a name="l00244"></a>00244         uint32                  m_homeId;                                   <span class="comment">// Home ID of the Z-Wave controller.  Not valid until the DriverReady notification has been received.</span>
<a name="l00245"></a>00245         
<a name="l00246"></a>00246         <span class="keywordtype">string</span>                  m_libraryVersion;                           <span class="comment">// Verison of the Z-Wave Library used by the controller.</span>
<a name="l00247"></a>00247         <span class="keywordtype">string</span>                  m_libraryTypeName;                          <span class="comment">// Name describing the library type.</span>
<a name="l00248"></a>00248         uint8                   m_libraryType;                              <span class="comment">// Type of library used by the controller.</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         uint8                   m_serialAPIVersion[2];
<a name="l00251"></a>00251         uint16                  m_manufacturerId;
<a name="l00252"></a>00252         uint16                  m_productType;
<a name="l00253"></a>00253         uint16                  m_productId;
<a name="l00254"></a>00254         uint8                   m_apiMask[32];
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         uint8                   m_initVersion;                              <span class="comment">// Version of the Serial API used by the controller.</span>
<a name="l00257"></a>00257         uint8                   m_initCaps;                                 <span class="comment">// Set of flags indicating the serial API capabilities (See IsSlave, HasTimerSupport, IsPrimaryController and IsStaticUpdateController above).</span>
<a name="l00258"></a>00258         uint8                   m_controllerCaps;                           <span class="comment">// Set of flags indicating the controller&#39;s capabilities (See IsInclusionController above).</span>
<a name="l00259"></a>00259         uint8                   m_nodeId;                                   <span class="comment">// Z-Wave Controller&#39;s own node ID.</span>
<a name="l00260"></a>00260         <a class="code" href="classOpenZWave_1_1Node.html" title="The Node class describes a Z-Wave node object...typically a device on the Z-Wave network.">Node</a>*                   m_nodes[256];                               <span class="comment">// Array containing all the node objects.</span>
<a name="l00261"></a>00261         <a class="code" href="classOpenZWave_1_1Mutex.html" title="Implements a platform-independent mutex--for serializing access to a shared resource.">Mutex</a>*                  m_nodeMutex;                                <span class="comment">// Serializes access to node data</span>
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <a class="code" href="classOpenZWave_1_1ControllerReplication.html" title="Implements COMMAND_CLASS_CONTROLLER_REPLICATION (0x21), a Z-Wave device command class.">ControllerReplication</a>*  m_controllerReplication;                    <span class="comment">// Controller replication is handled separately from the other command classes, due to older hand-held controllers using invalid node IDs.</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         uint8                   m_transmitOptions;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00268"></a>00268     <span class="comment">//  Receiving Z-Wave messages</span>
<a name="l00269"></a>00269     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00270"></a>00270     <span class="keyword">private</span>:
<a name="l00271"></a>00271         <span class="keywordtype">bool</span> ReadMsg();
<a name="l00272"></a>00272         <span class="keywordtype">void</span> ProcessMsg( uint8* _data );
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="keywordtype">void</span> HandleGetVersionResponse( uint8* _data );
<a name="l00275"></a>00275         <span class="keywordtype">void</span> HandleGetRandomResponse( uint8* _data );
<a name="l00276"></a>00276         <span class="keywordtype">void</span> HandleGetControllerCapabilitiesResponse( uint8* _data );
<a name="l00277"></a>00277         <span class="keywordtype">void</span> HandleGetSerialAPICapabilitiesResponse( uint8* _data );
<a name="l00278"></a>00278         <span class="keywordtype">void</span> HandleSerialAPISoftResetResponse( uint8* _data );
<a name="l00279"></a>00279         <span class="keywordtype">void</span> HandleEnableSUCResponse( uint8* _data );
<a name="l00280"></a>00280         <span class="keywordtype">void</span> HandleSetSUCNodeIdResponse( uint8* _data );
<a name="l00281"></a>00281         <span class="keywordtype">void</span> HandleGetSUCNodeIdResponse( uint8* _data );
<a name="l00282"></a>00282         <span class="keywordtype">void</span> HandleMemoryGetIdResponse( uint8* _data );
<a name="l00295"></a>00295         <span class="keywordtype">void</span> HandleSerialAPIGetInitDataResponse( uint8* _data );
<a name="l00296"></a>00296         <span class="keywordtype">void</span> HandleGetNodeProtocolInfoResponse( uint8* _data );
<a name="l00297"></a>00297         <span class="keywordtype">bool</span> HandleRemoveFailedNodeResponse( uint8* _data );
<a name="l00298"></a>00298         <span class="keywordtype">void</span> HandleIsFailedNodeResponse( uint8* _data );
<a name="l00299"></a>00299         <span class="keywordtype">bool</span> HandleReplaceFailedNodeResponse( uint8* _data );
<a name="l00300"></a>00300         <span class="keywordtype">bool</span> HandleAssignReturnRouteResponse( uint8* _data );
<a name="l00301"></a>00301         <span class="keywordtype">bool</span> HandleDeleteReturnRouteResponse( uint8* _data );
<a name="l00302"></a>00302         <span class="keywordtype">void</span> HandleSendNodeInformationRequest( uint8* _data );
<a name="l00303"></a>00303         <span class="keywordtype">void</span> HandleSendDataResponse( uint8* _data, <span class="keywordtype">bool</span> _replication );
<a name="l00304"></a>00304         <span class="keywordtype">bool</span> HandleNetworkUpdateResponse( uint8* _data );
<a name="l00305"></a>00305         <span class="keywordtype">void</span> HandleGetRoutingInfoResponse( uint8* _data );
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="keywordtype">void</span> HandleSendDataRequest( uint8* _data, <span class="keywordtype">bool</span> _replication );
<a name="l00308"></a>00308         <span class="keywordtype">void</span> HandleAddNodeToNetworkRequest( uint8* _data );
<a name="l00309"></a>00309         <span class="keywordtype">void</span> HandleCreateNewPrimaryRequest( uint8* _data );
<a name="l00310"></a>00310         <span class="keywordtype">void</span> HandleControllerChangeRequest( uint8* _data );
<a name="l00311"></a>00311         <span class="keywordtype">void</span> HandleSetLearnModeRequest( uint8* _data );
<a name="l00312"></a>00312         <span class="keywordtype">void</span> HandleRemoveFailedNodeRequest( uint8* _data );
<a name="l00313"></a>00313         <span class="keywordtype">void</span> HandleReplaceFailedNodeRequest( uint8* _data );
<a name="l00314"></a>00314         <span class="keywordtype">void</span> HandleRemoveNodeFromNetworkRequest( uint8* _data );
<a name="l00315"></a>00315         <span class="keywordtype">void</span> HandleApplicationCommandHandlerRequest( uint8* _data );
<a name="l00316"></a>00316         <span class="keywordtype">void</span> HandlePromiscuousApplicationCommandHandlerRequest( uint8* _data );
<a name="l00317"></a>00317         <span class="keywordtype">void</span> HandleAssignReturnRouteRequest( uint8* _data );
<a name="l00318"></a>00318         <span class="keywordtype">void</span> HandleDeleteReturnRouteRequest( uint8* _data );
<a name="l00319"></a>00319         <span class="keywordtype">void</span> HandleNodeNeighborUpdateRequest( uint8* _data );
<a name="l00320"></a>00320         <span class="keywordtype">void</span> HandleNetworkUpdateRequest( uint8* _data );
<a name="l00321"></a>00321         <span class="keywordtype">bool</span> HandleApplicationUpdateRequest( uint8* _data );
<a name="l00322"></a>00322         <span class="keywordtype">bool</span> HandleRfPowerLevelSetResponse( uint8* _data );
<a name="l00323"></a>00323         <span class="keywordtype">bool</span> HandleSerialApiSetTimeoutsResponse( uint8* _data );
<a name="l00324"></a>00324         <span class="keywordtype">bool</span> HandleMemoryGetByteResponse( uint8* _data );
<a name="l00325"></a>00325         <span class="keywordtype">bool</span> HandleReadMemoryResponse( uint8* _data );
<a name="l00326"></a>00326         <span class="keywordtype">void</span> HandleGetVirtualNodesResponse( uint8* _data );
<a name="l00327"></a>00327         <span class="keywordtype">bool</span> HandleSetSlaveLearnModeResponse( uint8* _data );
<a name="l00328"></a>00328         <span class="keywordtype">void</span> HandleSetSlaveLearnModeRequest( uint8* _data );
<a name="l00329"></a>00329         <span class="keywordtype">bool</span> HandleSendSlaveNodeInfoResponse( uint8* _data );
<a name="l00330"></a>00330         <span class="keywordtype">void</span> HandleSendSlaveNodeInfoRequest( uint8* _data );
<a name="l00331"></a>00331         <span class="keywordtype">void</span> HandleApplicationSlaveCommandRequest( uint8* _data );
<a name="l00332"></a>00332         <span class="keywordtype">void</span> HandleSerialAPIResetRequest( uint8* _data );
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <span class="keywordtype">void</span> CommonAddNodeStatusRequestHandler( uint8 _funcId, uint8* _data );
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         <span class="keywordtype">bool</span>                    m_waitingForAck;                            <span class="comment">// True when we are waiting for an ACK from the dongle</span>
<a name="l00337"></a>00337         uint8                   m_expectedCallbackId;                       <span class="comment">// If non-zero, we wait for a message with this callback Id</span>
<a name="l00338"></a>00338         uint8                   m_expectedReply;                            <span class="comment">// If non-zero, we wait for a message with this function Id</span>
<a name="l00339"></a>00339         uint8                   m_expectedCommandClassId;                   <span class="comment">// If the expected reply is FUNC_ID_APPLICATION_COMMAND_HANDLER, this value stores the command class we&#39;re waiting to hear from</span>
<a name="l00340"></a>00340         uint8                   m_expectedNodeId;                           <span class="comment">// If we are waiting for a FUNC_ID_APPLICATION_COMMAND_HANDLER, make sure we only accept it from this node.</span>
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00343"></a>00343     <span class="comment">//  Polling Z-Wave devices</span>
<a name="l00344"></a>00344     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00345"></a>00345     <span class="keyword">private</span>:
<a name="l00346"></a>00346         int32 GetPollInterval(){ <span class="keywordflow">return</span> m_pollInterval ; }
<a name="l00347"></a>00347         <span class="keywordtype">void</span> SetPollInterval( int32 _milliseconds, <span class="keywordtype">bool</span> _bIntervalBetweenPolls ){ m_pollInterval = _milliseconds; m_bIntervalBetweenPolls = _bIntervalBetweenPolls; }
<a name="l00348"></a>00348         <span class="keywordtype">bool</span> EnablePoll( <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> _valueId, uint8 _intensity = 1 );
<a name="l00349"></a>00349         <span class="keywordtype">bool</span> DisablePoll( <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> _valueId );
<a name="l00350"></a>00350         <span class="keywordtype">bool</span> isPolled( <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> _valueId );
<a name="l00351"></a>00351         <span class="keywordtype">void</span> SetPollIntensity( <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> _valueId, uint8 _intensity );
<a name="l00352"></a>00352         <span class="keyword">static</span> <span class="keywordtype">void</span> PollThreadEntryPoint( <a class="code" href="classOpenZWave_1_1Event.html" title="Platform-independent definition of event objects.">Event</a>* _exitEvent, <span class="keywordtype">void</span>* _context );
<a name="l00353"></a>00353         <span class="keywordtype">void</span> PollThreadProc( <a class="code" href="classOpenZWave_1_1Event.html" title="Platform-independent definition of event objects.">Event</a>* _exitEvent );
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         <a class="code" href="classOpenZWave_1_1Thread.html" title="Implements a platform-independent thread management class.">Thread</a>*                 m_pollThread;                               <span class="comment">// Thread for polling devices on the Z-Wave network</span>
<a name="l00356"></a>00356         <span class="keyword">struct </span>PollEntry
<a name="l00357"></a>00357         {
<a name="l00358"></a>00358             <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> m_id;
<a name="l00359"></a>00359             uint8   m_pollCounter;
<a name="l00360"></a>00360         };
<a name="l00361"></a>00361         list&lt;PollEntry&gt;         m_pollList;                                 <span class="comment">// List of nodes that need to be polled</span>
<a name="l00362"></a>00362         <a class="code" href="classOpenZWave_1_1Mutex.html" title="Implements a platform-independent mutex--for serializing access to a shared resource.">Mutex</a>*                  m_pollMutex;                                <span class="comment">// Serialize access to the polling list</span>
<a name="l00363"></a>00363         int32                   m_pollInterval;                             <span class="comment">// Time interval during which all nodes must be polled</span>
<a name="l00364"></a>00364         <span class="keywordtype">bool</span>                    m_bIntervalBetweenPolls;                    <span class="comment">// if true, the library intersperses m_pollInterval between polls; if false, the library attempts to complete all polls within m_pollInterval</span>
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00367"></a>00367     <span class="comment">//  Retrieving Node information</span>
<a name="l00368"></a>00368     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00369"></a>00369     <span class="keyword">public</span>:
<a name="l00370"></a>00370         uint8 GetNodeNumber( <a class="code" href="classOpenZWave_1_1Msg.html" title="Message object to be passed to and from devices on the Z-Wave network.">Msg</a> <span class="keyword">const</span>* _msg )<span class="keyword">const</span>{ <span class="keywordflow">return</span>  ( _msg == NULL ? 0 : _msg-&gt;<a class="code" href="classOpenZWave_1_1Msg.html#a0f9da3d94f530667e5eec09b2081ccd4" title="Identifies the Node ID of the &quot;target&quot; node (if any) for this function.">GetTargetNodeId</a>() ); }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keyword">private</span>:
<a name="l00381"></a>00381         <span class="keywordtype">void</span> InitNode( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordtype">void</span> InitAllNodes();                                                <span class="comment">// Delete all nodes and fetch the data from the Z-Wave network again.</span>
<a name="l00384"></a>00384         
<a name="l00385"></a>00385         <span class="keywordtype">bool</span> IsNodeListeningDevice( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00386"></a>00386         <span class="keywordtype">bool</span> IsNodeFrequentListeningDevice( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00387"></a>00387         <span class="keywordtype">bool</span> IsNodeBeamingDevice( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00388"></a>00388         <span class="keywordtype">bool</span> IsNodeRoutingDevice( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00389"></a>00389         <span class="keywordtype">bool</span> IsNodeSecurityDevice( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00390"></a>00390         uint32 GetNodeMaxBaudRate( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00391"></a>00391         uint8 GetNodeVersion( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00392"></a>00392         uint8 GetNodeSecurity( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00393"></a>00393         uint8 GetNodeBasic( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00394"></a>00394         uint8 GetNodeGeneric( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00395"></a>00395         uint8 GetNodeSpecific( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00396"></a>00396         <span class="keywordtype">string</span> GetNodeType( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00397"></a>00397         uint32 GetNodeNeighbors( uint8 <span class="keyword">const</span> _nodeId, uint8** o_neighbors );
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="keywordtype">string</span> GetNodeManufacturerName( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00400"></a>00400         <span class="keywordtype">string</span> GetNodeProductName( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00401"></a>00401         <span class="keywordtype">string</span> GetNodeName( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00402"></a>00402         <span class="keywordtype">string</span> GetNodeLocation( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="keywordtype">string</span> GetNodeManufacturerId( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00405"></a>00405         <span class="keywordtype">string</span> GetNodeProductType( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00406"></a>00406         <span class="keywordtype">string</span> GetNodeProductId( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00407"></a>00407         <span class="keywordtype">void</span> SetNodeManufacturerName( uint8 <span class="keyword">const</span> _nodeId, <span class="keywordtype">string</span> <span class="keyword">const</span>&amp; _manufacturerName );
<a name="l00408"></a>00408         <span class="keywordtype">void</span> SetNodeProductName( uint8 <span class="keyword">const</span> _nodeId, <span class="keywordtype">string</span> <span class="keyword">const</span>&amp; _productName );
<a name="l00409"></a>00409         <span class="keywordtype">void</span> SetNodeName( uint8 <span class="keyword">const</span> _nodeId, <span class="keywordtype">string</span> <span class="keyword">const</span>&amp; _nodeName );
<a name="l00410"></a>00410         <span class="keywordtype">void</span> SetNodeLocation( uint8 <span class="keyword">const</span> _nodeId, <span class="keywordtype">string</span> <span class="keyword">const</span>&amp; _location );
<a name="l00411"></a>00411         <span class="keywordtype">void</span> SetNodeLevel( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _level );
<a name="l00412"></a>00412         <span class="keywordtype">void</span> SetNodeOn( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00413"></a>00413         <span class="keywordtype">void</span> SetNodeOff( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         <a class="code" href="classOpenZWave_1_1Value.html" title="Base class for values associated with a node.">Value</a>* GetValue( <a class="code" href="classOpenZWave_1_1ValueID.html" title="Provides a unique ID for a value reported by a Z-Wave device.">ValueID</a> <span class="keyword">const</span>&amp; _id );
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="keywordtype">bool</span> IsAPICallSupported( uint8 <span class="keyword">const</span> _apinum )<span class="keyword">const</span>{ <span class="keywordflow">return</span> (( m_apiMask[( _apinum - 1 ) &gt;&gt; 3] &amp; ( 1 &lt;&lt; (( _apinum - 1 ) &amp; 0x07 ))) != 0 ); }
<a name="l00418"></a>00418         <span class="keywordtype">void</span> SetAPICall( uint8 <span class="keyword">const</span> _apinum, <span class="keywordtype">bool</span> _toSet )
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420             <span class="keywordflow">if</span>( _toSet )
<a name="l00421"></a>00421             {
<a name="l00422"></a>00422                 m_apiMask[( _apinum - 1 ) &gt;&gt; 3] |= ( 1 &lt;&lt; (( _apinum - 1 ) &amp; 0x07 ));
<a name="l00423"></a>00423             }
<a name="l00424"></a>00424             <span class="keywordflow">else</span>
<a name="l00425"></a>00425             {
<a name="l00426"></a>00426                 m_apiMask[( _apinum - 1 ) &gt;&gt; 3] &amp;= ~( 1 &lt;&lt; (( _apinum - 1 ) &amp; 0x07 ));
<a name="l00427"></a>00427             }
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         uint8 NodeFromMessage( uint8 <span class="keyword">const</span>* buffer );
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00432"></a>00432     <span class="comment">// Controller commands</span>
<a name="l00433"></a>00433     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00434"></a>00434     <span class="keyword">public</span>: 
<a name="l00440"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9">00440</a>         <span class="keyword">enum</span> <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9">ControllerCommand</a>
<a name="l00441"></a>00441         {
<a name="l00442"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a04df8000125e588842882ff9e7cbe6cd">00442</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a04df8000125e588842882ff9e7cbe6cd">ControllerCommand_None</a> = 0,                 
<a name="l00443"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aee5c0aa1c85ff6ae158dc0f6cac4db21">00443</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aee5c0aa1c85ff6ae158dc0f6cac4db21">ControllerCommand_AddDevice</a>,                    
<a name="l00444"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a9d479c7eb736e772316559ee28be570d">00444</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a9d479c7eb736e772316559ee28be570d">ControllerCommand_CreateNewPrimary</a>,             
<a name="l00445"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae3e11612fa0d2b9ffa0f65a660b1a4da">00445</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae3e11612fa0d2b9ffa0f65a660b1a4da">ControllerCommand_ReceiveConfiguration</a>,             
<a name="l00446"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a5680ebfe2046f30a25cb68d6fb276aa2">00446</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a5680ebfe2046f30a25cb68d6fb276aa2">ControllerCommand_RemoveDevice</a>,                 
<a name="l00447"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a0a284bd7475619bf8eae7f612b8cb082">00447</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a0a284bd7475619bf8eae7f612b8cb082">ControllerCommand_RemoveFailedNode</a>,             
<a name="l00448"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae9a2aa7f88664b54b1dabdb3f2ef42fd">00448</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae9a2aa7f88664b54b1dabdb3f2ef42fd">ControllerCommand_HasNodeFailed</a>,                
<a name="l00449"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a88d4878eadbd540c3d5416e7ca76249d">00449</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a88d4878eadbd540c3d5416e7ca76249d">ControllerCommand_ReplaceFailedNode</a>,                
<a name="l00450"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a88488b186c16c34aaafccb9f3d700aba">00450</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a88488b186c16c34aaafccb9f3d700aba">ControllerCommand_TransferPrimaryRole</a>,              
<a name="l00451"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a48c276034683ed3d074ef821751754ea">00451</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a48c276034683ed3d074ef821751754ea">ControllerCommand_RequestNetworkUpdate</a>,             
<a name="l00452"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a6e0e7a916e53d0291a99f3a9d71cd589">00452</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a6e0e7a916e53d0291a99f3a9d71cd589">ControllerCommand_RequestNodeNeighborUpdate</a>,            
<a name="l00453"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a4015a26cc4c79ae89a2981ec7c2c12f1">00453</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a4015a26cc4c79ae89a2981ec7c2c12f1">ControllerCommand_AssignReturnRoute</a>,                
<a name="l00454"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aaa82e9af2b9e3ac8489598c8a8ad45ca">00454</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aaa82e9af2b9e3ac8489598c8a8ad45ca">ControllerCommand_DeleteAllReturnRoutes</a>,            
<a name="l00455"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aae8a7b8053ab773f95018c62e0eb083f">00455</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9aae8a7b8053ab773f95018c62e0eb083f">ControllerCommand_SendNodeInformation</a>,              
<a name="l00456"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a6ca8a81901f42bdb1d4a64e80079e0ee">00456</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9a6ca8a81901f42bdb1d4a64e80079e0ee">ControllerCommand_ReplicationSend</a>,              
<a name="l00457"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae4f67a03f324f693855c8e026748b56a">00457</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ae4f67a03f324f693855c8e026748b56a">ControllerCommand_CreateButton</a>,                 
<a name="l00458"></a><a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ab3f52b401c7eac36a350f4158e6cc83c">00458</a>             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9ab3f52b401c7eac36a350f4158e6cc83c">ControllerCommand_DeleteButton</a>                  
<a name="l00459"></a>00459         };
<a name="l00460"></a>00460 
<a name="l00466"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8">00466</a>         <span class="keyword">enum</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8">ControllerState</a>
<a name="l00467"></a>00467         {
<a name="l00468"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a9cd1833a9e0a225d110fc6f12c32553f">00468</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a9cd1833a9e0a225d110fc6f12c32553f">ControllerState_Normal</a> = 0,             
<a name="l00469"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ac4e45cc9d8feec4ce19c866df5b59eef">00469</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ac4e45cc9d8feec4ce19c866df5b59eef">ControllerState_Starting</a>,               
<a name="l00470"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a5bc2f065855babb3b0d2ffbe588d8859">00470</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a5bc2f065855babb3b0d2ffbe588d8859">ControllerState_Cancel</a>,                 
<a name="l00471"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ada30f29f76d01c158cd2bcf6237a2ed3">00471</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ada30f29f76d01c158cd2bcf6237a2ed3">ControllerState_Error</a>,                  
<a name="l00472"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a51e374907339d74485852171535f3de1">00472</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a51e374907339d74485852171535f3de1">ControllerState_Waiting</a>,                
<a name="l00473"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ac4b0aab4a63f6f68fba34c6b4f501806">00473</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ac4b0aab4a63f6f68fba34c6b4f501806">ControllerState_Sleeping</a>,               
<a name="l00474"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a5563d9763e8684df608231fec5f91043">00474</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a5563d9763e8684df608231fec5f91043">ControllerState_InProgress</a>,             
<a name="l00475"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a42a5376657d6dde691666ed1ebb64b10">00475</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a42a5376657d6dde691666ed1ebb64b10">ControllerState_Completed</a>,                  
<a name="l00476"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a08c811cf0ec9ef751ae52fa62bf025ad">00476</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a08c811cf0ec9ef751ae52fa62bf025ad">ControllerState_Failed</a>,                 
<a name="l00477"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a3bcbbd831de5bc96233441075eb7e146">00477</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a3bcbbd831de5bc96233441075eb7e146">ControllerState_NodeOK</a>,                 
<a name="l00478"></a><a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8af994369afc5b43e847e7f5512adf9f3e">00478</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8af994369afc5b43e847e7f5512adf9f3e">ControllerState_NodeFailed</a>              
<a name="l00479"></a>00479         };
<a name="l00480"></a>00480 
<a name="l00485"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7c">00485</a>         <span class="keyword">enum</span> <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7c">ControllerError</a>
<a name="l00486"></a>00486         {
<a name="l00487"></a>00487             ControllerError_None = 0,
<a name="l00488"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cafa0b59717299f206b617ac631d975f92">00488</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cafa0b59717299f206b617ac631d975f92">ControllerError_ButtonNotFound</a>,                 
<a name="l00489"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cabe9473f13ef261933b84c652762a403d">00489</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cabe9473f13ef261933b84c652762a403d">ControllerError_NodeNotFound</a>,                   
<a name="l00490"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7caca806bc4832c843966a39a5eee484c77">00490</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7caca806bc4832c843966a39a5eee484c77">ControllerError_NotBridge</a>,                  
<a name="l00491"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cad500389eaf952bcdcb1db80a0657e5b7">00491</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cad500389eaf952bcdcb1db80a0657e5b7">ControllerError_NotSUC</a>,                     
<a name="l00492"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca2158df0b1b8480251494c01eb574612b">00492</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca2158df0b1b8480251494c01eb574612b">ControllerError_NotSecondary</a>,                   
<a name="l00493"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca721c7d9fe6523ac05c7da6868b37abd2">00493</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca721c7d9fe6523ac05c7da6868b37abd2">ControllerError_NotPrimary</a>,                 
<a name="l00494"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca8358b66cc41a0ed35bf159baf0819e04">00494</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca8358b66cc41a0ed35bf159baf0819e04">ControllerError_IsPrimary</a>,                  
<a name="l00495"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cafc5a5468d4fa6d2421bc1422cb73e8eb">00495</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cafc5a5468d4fa6d2421bc1422cb73e8eb">ControllerError_NotFound</a>,                   
<a name="l00496"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca07188f47d799d459fbf6f53d0e5bd296">00496</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca07188f47d799d459fbf6f53d0e5bd296">ControllerError_Busy</a>,                       
<a name="l00497"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7caa82850d09e9878af0711f56f9fe4532a">00497</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7caa82850d09e9878af0711f56f9fe4532a">ControllerError_Failed</a>,                     
<a name="l00498"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca20fcfcdce4074ccc75560bbc810409de">00498</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7ca20fcfcdce4074ccc75560bbc810409de">ControllerError_Disabled</a>,                   
<a name="l00499"></a><a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cacfdbeddbb5689cfb9802c7f71d787b04">00499</a>             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7cacfdbeddbb5689cfb9802c7f71d787b04">ControllerError_Overflow</a>                    
<a name="l00500"></a>00500         };
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="keyword">typedef</span> void (*pfnControllerCallback_t)( <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8">ControllerState</a> _state, <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7c">ControllerError</a> _err, <span class="keywordtype">void</span>* _context );
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keyword">private</span>:
<a name="l00505"></a>00505         <span class="comment">// The public interface is provided via the wrappers in the Manager class</span>
<a name="l00506"></a>00506         <span class="keywordtype">void</span> ResetController( <a class="code" href="classOpenZWave_1_1Event.html" title="Platform-independent definition of event objects.">Event</a>* _evt );
<a name="l00507"></a>00507         <span class="keywordtype">void</span> SoftReset();
<a name="l00508"></a>00508         <span class="keywordtype">void</span> RequestNodeNeighbors( uint8 <span class="keyword">const</span> _nodeId, uint32 <span class="keyword">const</span> _requestFlags );
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordtype">bool</span> BeginControllerCommand( <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9">ControllerCommand</a> _command, pfnControllerCallback_t _callback, <span class="keywordtype">void</span>* _context, <span class="keywordtype">bool</span> _highPower, uint8 _nodeId, uint8 _arg );
<a name="l00511"></a>00511         <span class="keywordtype">bool</span> CancelControllerCommand();
<a name="l00512"></a>00512         <span class="keywordtype">void</span> AddNodeStop( uint8 <span class="keyword">const</span> _funcId );                    <span class="comment">// Handle different controller behaviors</span>
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="keyword">struct </span>ControllerCommandItem
<a name="l00515"></a>00515         {
<a name="l00516"></a>00516             <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8">ControllerState</a>             m_controllerState;
<a name="l00517"></a>00517             <span class="keywordtype">bool</span>                    m_controllerStateChanged;
<a name="l00518"></a>00518             <span class="keywordtype">bool</span>                    m_controllerCommandDone;
<a name="l00519"></a>00519             <a class="code" href="classOpenZWave_1_1Driver.html#ac1a7f80c64bd9e5147be468b7b5a40d9">ControllerCommand</a>           m_controllerCommand;
<a name="l00520"></a>00520             pfnControllerCallback_t         m_controllerCallback;
<a name="l00521"></a>00521             <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7c">ControllerError</a>             m_controllerReturnError;
<a name="l00522"></a>00522             <span class="keywordtype">void</span>*                   m_controllerCallbackContext;
<a name="l00523"></a>00523             <span class="keywordtype">bool</span>                    m_highPower;
<a name="l00524"></a>00524             <span class="keywordtype">bool</span>                    m_controllerAdded;
<a name="l00525"></a>00525             uint8                   m_controllerCommandNode;
<a name="l00526"></a>00526             uint8                   m_controllerCommandArg;
<a name="l00527"></a>00527         };
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         ControllerCommandItem*          m_currentControllerCommand;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="keywordtype">void</span> DoControllerCommand();
<a name="l00532"></a>00532         <span class="keywordtype">void</span> UpdateControllerState( <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8">ControllerState</a> <span class="keyword">const</span> _state, <a class="code" href="classOpenZWave_1_1Driver.html#a16d2da7b78f8eefc79ef4046d8148e7c">ControllerError</a> <span class="keyword">const</span> _error = ControllerError_None )
<a name="l00533"></a>00533         {
<a name="l00534"></a>00534             <span class="keywordflow">if</span>( m_currentControllerCommand != NULL )
<a name="l00535"></a>00535             {
<a name="l00536"></a>00536                 <span class="keywordflow">if</span>( _state != m_currentControllerCommand-&gt;m_controllerState )
<a name="l00537"></a>00537                 {
<a name="l00538"></a>00538                     m_currentControllerCommand-&gt;m_controllerStateChanged = <span class="keyword">true</span>;
<a name="l00539"></a>00539                     m_currentControllerCommand-&gt;m_controllerState = _state;
<a name="l00540"></a>00540                     <span class="keywordflow">switch</span>( _state )
<a name="l00541"></a>00541                     {
<a name="l00542"></a>00542                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ada30f29f76d01c158cd2bcf6237a2ed3">ControllerState_Error</a>:
<a name="l00543"></a>00543                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a5bc2f065855babb3b0d2ffbe588d8859">ControllerState_Cancel</a>:
<a name="l00544"></a>00544                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a08c811cf0ec9ef751ae52fa62bf025ad">ControllerState_Failed</a>:
<a name="l00545"></a>00545                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8ac4b0aab4a63f6f68fba34c6b4f501806">ControllerState_Sleeping</a>:
<a name="l00546"></a>00546                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8af994369afc5b43e847e7f5512adf9f3e">ControllerState_NodeFailed</a>:
<a name="l00547"></a>00547                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a3bcbbd831de5bc96233441075eb7e146">ControllerState_NodeOK</a>:
<a name="l00548"></a>00548                         <span class="keywordflow">case</span> <a class="code" href="classOpenZWave_1_1Driver.html#a5595393f6aac3175bb17f00cf53356a8a42a5376657d6dde691666ed1ebb64b10">ControllerState_Completed</a>:
<a name="l00549"></a>00549                         {
<a name="l00550"></a>00550                             m_currentControllerCommand-&gt;m_controllerCommandDone = <span class="keyword">true</span>;
<a name="l00551"></a>00551                             m_sendMutex-&gt;<a class="code" href="classOpenZWave_1_1Mutex.html#ab77747a0fbc1a7090f3ffa4b8972e909">Lock</a>();
<a name="l00552"></a>00552                             m_queueEvent[MsgQueue_Controller]-&gt;<a class="code" href="classOpenZWave_1_1Event.html#a95922040917d880ef02da2eedbebe544">Set</a>();
<a name="l00553"></a>00553                             m_sendMutex-&gt;<a class="code" href="classOpenZWave_1_1Mutex.html#ad5de61abafec4bbec4cd7e796e5209fd">Unlock</a>();
<a name="l00554"></a>00554                             <span class="keywordflow">break</span>;
<a name="l00555"></a>00555                         }
<a name="l00556"></a>00556                         <span class="keywordflow">default</span>:
<a name="l00557"></a>00557                         {
<a name="l00558"></a>00558                             <span class="keywordflow">break</span>;
<a name="l00559"></a>00559                         }
<a name="l00560"></a>00560                     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562                 }
<a name="l00563"></a>00563                 <span class="keywordflow">if</span>( _error != ControllerError_None )
<a name="l00564"></a>00564                 {
<a name="l00565"></a>00565                     m_currentControllerCommand-&gt;m_controllerReturnError = _error;
<a name="l00566"></a>00566                 }
<a name="l00567"></a>00567             }
<a name="l00568"></a>00568         }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         uint8                   m_SUCNodeId;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="keywordtype">void</span> UpdateNodeRoutes( uint8 const_nodeId, <span class="keywordtype">bool</span> _doUpdate = <span class="keyword">false</span> );
<a name="l00573"></a>00573 
<a name="l00574"></a>00574         Event*                  m_controllerResetEvent;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00577"></a>00577     <span class="comment">//  Sending Z-Wave messages</span>
<a name="l00578"></a>00578     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00579"></a>00579     <span class="keyword">public</span>:
<a name="l00580"></a>00580         <span class="keyword">enum</span> MsgQueue
<a name="l00581"></a>00581         {
<a name="l00582"></a>00582             MsgQueue_Command = 0,
<a name="l00583"></a>00583             MsgQueue_NoOp,
<a name="l00584"></a>00584             MsgQueue_Controller,
<a name="l00585"></a>00585             MsgQueue_WakeUp,
<a name="l00586"></a>00586             MsgQueue_Send,
<a name="l00587"></a>00587             MsgQueue_Query,
<a name="l00588"></a>00588             MsgQueue_Poll,
<a name="l00589"></a>00589             MsgQueue_Count      <span class="comment">// Number of message queues</span>
<a name="l00590"></a>00590         };
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <span class="keywordtype">void</span> SendMsg( Msg* _msg, MsgQueue <span class="keyword">const</span> _queue );
<a name="l00593"></a>00593 
<a name="l00597"></a><a class="code" href="classOpenZWave_1_1Driver.html#a928f8cdb8be3c4d9986dfa84ad7d0776">00597</a>         uint8 <a class="code" href="classOpenZWave_1_1Driver.html#a928f8cdb8be3c4d9986dfa84ad7d0776">GetTransmitOptions</a>()<span class="keyword">const</span>{ <span class="keywordflow">return</span> m_transmitOptions; }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="keyword">private</span>:
<a name="l00617"></a>00617         <span class="keywordtype">bool</span> WriteNextMsg( MsgQueue <span class="keyword">const</span> _queue );                         <span class="comment">// Extracts the first message from the queue, and makes it the current one.</span>
<a name="l00618"></a>00618         <span class="keywordtype">bool</span> WriteMsg( <span class="keywordtype">string</span> <span class="keyword">const</span> str);                                   <span class="comment">// Sends the current message to the Z-Wave network</span>
<a name="l00619"></a>00619         <span class="keywordtype">void</span> RemoveCurrentMsg();                                            <span class="comment">// Deletes the current message and cleans up the callback etc states</span>
<a name="l00620"></a>00620         <span class="keywordtype">bool</span> MoveMessagesToWakeUpQueue( uint8 <span class="keyword">const</span> _targetNodeId, <span class="keywordtype">bool</span> <span class="keyword">const</span> _move );      <span class="comment">// If a node does not respond, and is of a type that can sleep, this method is used to move all its pending messages to another queue ready for when it mext wakes up.</span>
<a name="l00621"></a>00621         <span class="keywordtype">bool</span> HandleErrorResponse( uint8 <span class="keyword">const</span> _error, uint8 <span class="keyword">const</span> _nodeId, <span class="keywordtype">char</span> <span class="keyword">const</span>* _funcStr, <span class="keywordtype">bool</span> _sleepCheck = <span class="keyword">false</span> );                                        <span class="comment">// Handle data errors and process consistently. If message is moved to wake-up queue, return true.</span>
<a name="l00622"></a>00622         <span class="keywordtype">bool</span> IsExpectedReply( uint8 <span class="keyword">const</span> _nodeId );                        <span class="comment">// Determine if reply message is the one we are expecting</span>
<a name="l00623"></a>00623         <span class="keywordtype">void</span> SendQueryStageComplete( uint8 <span class="keyword">const</span> _nodeId, <a class="code" href="classOpenZWave_1_1Node.html#a8c740c962a9230d840984ca644e1f220">Node::QueryStage</a> <span class="keyword">const</span> _stage );
<a name="l00624"></a>00624         <span class="keywordtype">void</span> RetryQueryStageComplete( uint8 <span class="keyword">const</span> _nodeId, <a class="code" href="classOpenZWave_1_1Node.html#a8c740c962a9230d840984ca644e1f220">Node::QueryStage</a> <span class="keyword">const</span> _stage );
<a name="l00625"></a>00625         <span class="keywordtype">void</span> CheckCompletedNodeQueries();                                   <span class="comment">// Send notifications if all awake and/or sleeping nodes have completed their queries</span>
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         <span class="comment">// Requests to be sent to nodes are assigned to one of five queues.</span>
<a name="l00628"></a>00628         <span class="comment">// From highest to lowest priority, these are</span>
<a name="l00629"></a>00629         <span class="comment">//</span>
<a name="l00630"></a>00630         <span class="comment">// 1)   The command queue, for controller commands.  This is the highest</span>
<a name="l00631"></a>00631         <span class="comment">//      priority send queue, because the controller command processes are not</span>
<a name="l00632"></a>00632         <span class="comment">//      permitted to be interupted by other requests.</span>
<a name="l00633"></a>00633         <span class="comment">//</span>
<a name="l00634"></a>00634         <span class="comment">// 2)   The controller queue exists to handle multi-step controller commands. These</span>
<a name="l00635"></a>00635         <span class="comment">//      typically require user interaction or affect the network in some way.</span>
<a name="l00636"></a>00636         <span class="comment">//</span>
<a name="l00637"></a>00637         <span class="comment">// 3)   The No Operation command class queue. This is used for device probing</span>
<a name="l00638"></a>00638         <span class="comment">//      at startup as well as network diagostics.</span>
<a name="l00639"></a>00639         <span class="comment">//</span>
<a name="l00640"></a>00640         <span class="comment">// 4)   The wakeup queue.  This holds messages that have been held for a </span>
<a name="l00641"></a>00641         <span class="comment">//      sleeping device that has now woken up.  These get a high priority</span>
<a name="l00642"></a>00642         <span class="comment">//      because such devices do not stay awake for very long.</span>
<a name="l00643"></a>00643         <span class="comment">//</span>
<a name="l00644"></a>00644         <span class="comment">// 5)   The send queue.  This is for normal messages, usually triggered by</span>
<a name="l00645"></a>00645         <span class="comment">//      a user interaction with the application.</span>
<a name="l00646"></a>00646         <span class="comment">//</span>
<a name="l00647"></a>00647         <span class="comment">// 6)   The query queue.  For node query messages sent when a new node is</span>
<a name="l00648"></a>00648         <span class="comment">//      discovered.  The query process generates a large number of requests,</span>
<a name="l00649"></a>00649         <span class="comment">//      so the query queue has a low priority to avoid making the system</span>
<a name="l00650"></a>00650         <span class="comment">//      unresponsive.</span>
<a name="l00651"></a>00651         <span class="comment">//</span>
<a name="l00652"></a>00652         <span class="comment">// 7)   The poll queue.  Requests to devices that need their state polling</span>
<a name="l00653"></a>00653         <span class="comment">//      at regular intervals.  These are of the lowest priority, and are only</span>
<a name="l00654"></a>00654         <span class="comment">//      sent when nothing else is going on</span>
<a name="l00655"></a>00655         <span class="comment">//</span>
<a name="l00656"></a>00656         <span class="keyword">enum</span> MsgQueueCmd
<a name="l00657"></a>00657         {
<a name="l00658"></a>00658             MsgQueueCmd_SendMsg = 0,
<a name="l00659"></a>00659             MsgQueueCmd_QueryStageComplete,
<a name="l00660"></a>00660             MsgQueueCmd_Controller
<a name="l00661"></a>00661         };
<a name="l00662"></a>00662         
<a name="l00663"></a>00663         <span class="keyword">class </span>MsgQueueItem
<a name="l00664"></a>00664         {
<a name="l00665"></a>00665         <span class="keyword">public</span>:
<a name="l00666"></a>00666             <span class="keywordtype">bool</span> operator == ( MsgQueueItem <span class="keyword">const</span>&amp; _other )<span class="keyword">const</span>
<a name="l00667"></a>00667 <span class="keyword">            </span>{
<a name="l00668"></a>00668                 <span class="keywordflow">if</span>( _other.m_command == m_command )
<a name="l00669"></a>00669                 {
<a name="l00670"></a>00670                     <span class="keywordflow">if</span>( m_command == MsgQueueCmd_SendMsg )
<a name="l00671"></a>00671                     {
<a name="l00672"></a>00672                         <span class="keywordflow">return</span>( (*_other.m_msg) == (*m_msg) );
<a name="l00673"></a>00673                     }
<a name="l00674"></a>00674                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( m_command == MsgQueueCmd_QueryStageComplete )
<a name="l00675"></a>00675                     {
<a name="l00676"></a>00676                         <span class="keywordflow">return</span>( (_other.m_nodeId == m_nodeId) &amp;&amp; (_other.m_queryStage == m_queryStage) );
<a name="l00677"></a>00677                     }
<a name="l00678"></a>00678                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( m_command == MsgQueueCmd_Controller )
<a name="l00679"></a>00679                     {
<a name="l00680"></a>00680                         <span class="keywordflow">return</span>( (_other.m_cci-&gt;m_controllerCommand == m_cci-&gt;m_controllerCommand) &amp;&amp; (_other.m_cci-&gt;m_controllerCallback == m_cci-&gt;m_controllerCallback) );
<a name="l00681"></a>00681                     }
<a name="l00682"></a>00682                 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00685"></a>00685             }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687             MsgQueueCmd         m_command;
<a name="l00688"></a>00688             Msg*                m_msg;
<a name="l00689"></a>00689             uint8               m_nodeId;
<a name="l00690"></a>00690             <a class="code" href="classOpenZWave_1_1Node.html#a8c740c962a9230d840984ca644e1f220">Node::QueryStage</a>        m_queryStage;
<a name="l00691"></a>00691             <span class="keywordtype">bool</span>                m_retry;
<a name="l00692"></a>00692             ControllerCommandItem*      m_cci;
<a name="l00693"></a>00693         };
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         list&lt;MsgQueueItem&gt;          m_msgQueue[MsgQueue_Count];
<a name="l00696"></a>00696         Event*                  m_queueEvent[MsgQueue_Count];               <span class="comment">// Events for each queue, which are signalled when the queue is not empty</span>
<a name="l00697"></a>00697         Mutex*                  m_sendMutex;                        <span class="comment">// Serialize access to the queues</span>
<a name="l00698"></a>00698         Msg*                    m_currentMsg;
<a name="l00699"></a>00699         MsgQueue                m_currentMsgQueueSource;            <span class="comment">// identifies which queue held m_currentMsg</span>
<a name="l00700"></a>00700         TimeStamp               m_resendTimeStamp;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00703"></a>00703     <span class="comment">// Network functions</span>
<a name="l00704"></a>00704     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00705"></a>00705     <span class="keyword">private</span>:
<a name="l00706"></a>00706         <span class="keywordtype">void</span> TestNetwork( uint8 <span class="keyword">const</span> _nodeId, uint32 <span class="keyword">const</span> _count );
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00709"></a>00709     <span class="comment">// Virtual Node commands</span>
<a name="l00710"></a>00710     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00711"></a>00711     <span class="keyword">public</span>: 
<a name="l00716"></a>00716     <span class="keyword">private</span>:
<a name="l00717"></a>00717         uint32 GetVirtualNeighbors( uint8** o_neighbors );
<a name="l00718"></a>00718         <span class="keywordtype">void</span> RequestVirtualNeighbors( MsgQueue <span class="keyword">const</span> _queue );
<a name="l00719"></a>00719         <span class="keywordtype">bool</span> IsVirtualNode( uint8 <span class="keyword">const</span> _nodeId )<span class="keyword">const</span>{  <span class="keywordflow">return</span> (( m_virtualNeighbors[( _nodeId - 1 ) &gt;&gt; 3] &amp; 1 &lt;&lt; (( _nodeId - 1 ) &amp; 0x07 )) != 0 ); }
<a name="l00720"></a>00720         <span class="keywordtype">void</span> SendVirtualNodeInfo( uint8 <span class="keyword">const</span> _fromNodeId, uint8 <span class="keyword">const</span> _ToNodeId );
<a name="l00721"></a>00721         <span class="keywordtype">void</span> SendSlaveLearnModeOff();
<a name="l00722"></a>00722         <span class="keywordtype">void</span> SaveButtons();
<a name="l00723"></a>00723         <span class="keywordtype">void</span> ReadButtons( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         <span class="keywordtype">bool</span>        m_virtualNeighborsReceived;
<a name="l00726"></a>00726         uint8       m_virtualNeighbors[NUM_NODE_BITFIELD_BYTES];        <span class="comment">// Bitmask containing virtual neighbors</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00729"></a>00729     <span class="comment">// SwitchAll</span>
<a name="l00730"></a>00730     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00731"></a>00731     <span class="keyword">private</span>:        
<a name="l00732"></a>00732         <span class="comment">// The public interface is provided via the wrappers in the Manager class</span>
<a name="l00733"></a>00733         <span class="keywordtype">void</span> SwitchAllOn();
<a name="l00734"></a>00734         <span class="keywordtype">void</span> SwitchAllOff();
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00737"></a>00737     <span class="comment">// Configuration Parameters (wrappers for the Node methods)</span>
<a name="l00738"></a>00738     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00739"></a>00739     <span class="keyword">private</span>:        
<a name="l00740"></a>00740         <span class="comment">// The public interface is provided via the wrappers in the Manager class</span>
<a name="l00741"></a>00741         <span class="keywordtype">bool</span> SetConfigParam( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _param, int32 _value, uint8 <span class="keyword">const</span> _size );
<a name="l00742"></a>00742         <span class="keywordtype">void</span> RequestConfigParam( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _param );
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00745"></a>00745     <span class="comment">// Groups (wrappers for the Node methods)</span>
<a name="l00746"></a>00746     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00747"></a>00747     <span class="keyword">private</span>:        
<a name="l00748"></a>00748         <span class="comment">// The public interface is provided via the wrappers in the Manager class</span>
<a name="l00749"></a>00749         uint8 GetNumGroups( uint8 <span class="keyword">const</span> _nodeId );
<a name="l00750"></a>00750         uint32 GetAssociations( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _groupIdx, uint8** o_associations );
<a name="l00751"></a>00751         uint8 GetMaxAssociations( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _groupIdx );
<a name="l00752"></a>00752         <span class="keywordtype">string</span> GetGroupLabel( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _groupIdx );
<a name="l00753"></a>00753         <span class="keywordtype">void</span> AddAssociation( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _groupIdx, uint8 <span class="keyword">const</span> _targetNodeId );
<a name="l00754"></a>00754         <span class="keywordtype">void</span> RemoveAssociation( uint8 <span class="keyword">const</span> _nodeId, uint8 <span class="keyword">const</span> _groupIdx, uint8 <span class="keyword">const</span> _targetNodeId );
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00757"></a>00757     <span class="comment">//  Notifications</span>
<a name="l00758"></a>00758     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00759"></a>00759     <span class="keyword">private</span>:
<a name="l00760"></a>00760         <span class="keywordtype">void</span> QueueNotification( Notification* _notification );              <span class="comment">// Adds a notification to the list.  Notifications are queued until a point in the thread where we know we do not have any nodes locked.</span>
<a name="l00761"></a>00761         <span class="keywordtype">void</span> NotifyWatchers();                                              <span class="comment">// Passes the notifications to all the registered watcher callbacks in turn.</span>
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         list&lt;Notification*&gt;     m_notifications;
<a name="l00764"></a>00764         Event*              m_notificationsEvent;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00767"></a>00767     <span class="comment">//  Statistics</span>
<a name="l00768"></a>00768     <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00769"></a>00769     <span class="keyword">public</span>:
<a name="l00770"></a><a class="code" href="structOpenZWave_1_1Driver_1_1DriverData.html">00770</a>         <span class="keyword">struct </span><a class="code" href="structOpenZWave_1_1Driver_1_1DriverData.html">DriverData</a>
<a name="l00771"></a>00771         {
<a name="l00772"></a>00772             uint32 m_SOFCnt;            <span class="comment">// Number of SOF bytes received</span>
<a name="l00773"></a>00773             uint32 m_ACKWaiting;            <span class="comment">// Number of unsolicited messages while waiting for an ACK</span>
<a name="l00774"></a>00774             uint32 m_readAborts;            <span class="comment">// Number of times read were aborted due to timeouts</span>
<a name="l00775"></a>00775             uint32 m_badChecksum;           <span class="comment">// Number of bad checksums</span>
<a name="l00776"></a>00776             uint32 m_readCnt;           <span class="comment">// Number of messages successfully read</span>
<a name="l00777"></a>00777             uint32 m_writeCnt;          <span class="comment">// Number of messages successfully sent</span>
<a name="l00778"></a>00778             uint32 m_CANCnt;            <span class="comment">// Number of CAN bytes received</span>
<a name="l00779"></a>00779             uint32 m_NAKCnt;            <span class="comment">// Number of NAK bytes received</span>
<a name="l00780"></a>00780             uint32 m_ACKCnt;            <span class="comment">// Number of ACK bytes received</span>
<a name="l00781"></a>00781             uint32 m_OOFCnt;            <span class="comment">// Number of bytes out of framing</span>
<a name="l00782"></a>00782             uint32 m_dropped;           <span class="comment">// Number of messages dropped &amp; not delivered</span>
<a name="l00783"></a>00783             uint32 m_retries;           <span class="comment">// Number of messages retransmitted</span>
<a name="l00784"></a>00784             uint32 m_callbacks;         <span class="comment">// Number of unexpected callbacks</span>
<a name="l00785"></a>00785             uint32 m_badroutes;         <span class="comment">// Number of failed messages due to bad route response</span>
<a name="l00786"></a>00786             uint32 m_noack;             <span class="comment">// Number of no ACK returned errors</span>
<a name="l00787"></a>00787             uint32 m_netbusy;           <span class="comment">// Number of network busy/failure messages</span>
<a name="l00788"></a>00788             uint32 m_notidle;
<a name="l00789"></a>00789             uint32 m_nondelivery;           <span class="comment">// Number of messages not delivered to network</span>
<a name="l00790"></a>00790             uint32 m_routedbusy;            <span class="comment">// Number of messages received with routed busy status</span>
<a name="l00791"></a>00791             uint32 m_broadcastReadCnt;      <span class="comment">// Number of broadcasts read</span>
<a name="l00792"></a>00792             uint32 m_broadcastWriteCnt;     <span class="comment">// Number of broadcasts sent</span>
<a name="l00793"></a>00793         };
<a name="l00794"></a>00794 
<a name="l00795"></a>00795         <span class="keywordtype">void</span> LogDriverStatistics();
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="keyword">private</span>:
<a name="l00798"></a>00798         <span class="keywordtype">void</span> GetDriverStatistics( <a class="code" href="structOpenZWave_1_1Driver_1_1DriverData.html">DriverData</a>* _data );
<a name="l00799"></a>00799         <span class="keywordtype">void</span> GetNodeStatistics( uint8 <span class="keyword">const</span> _nodeId, <a class="code" href="structOpenZWave_1_1Node_1_1NodeData.html">Node::NodeData</a>* _data );
<a name="l00800"></a>00800 
<a name="l00801"></a>00801         uint32 m_SOFCnt;            <span class="comment">// Number of SOF bytes received</span>
<a name="l00802"></a>00802         uint32 m_ACKWaiting;            <span class="comment">// Number of unsolcited messages while waiting for an ACK</span>
<a name="l00803"></a>00803         uint32 m_readAborts;            <span class="comment">// Number of times read were aborted due to timeouts</span>
<a name="l00804"></a>00804         uint32 m_badChecksum;           <span class="comment">// Number of bad checksums</span>
<a name="l00805"></a>00805         uint32 m_readCnt;           <span class="comment">// Number of messages successfully read</span>
<a name="l00806"></a>00806         uint32 m_writeCnt;          <span class="comment">// Number of messages successfully sent</span>
<a name="l00807"></a>00807         uint32 m_CANCnt;            <span class="comment">// Number of CAN bytes received</span>
<a name="l00808"></a>00808         uint32 m_NAKCnt;            <span class="comment">// Number of NAK bytes received</span>
<a name="l00809"></a>00809         uint32 m_ACKCnt;            <span class="comment">// Number of ACK bytes received</span>
<a name="l00810"></a>00810         uint32 m_OOFCnt;            <span class="comment">// Number of bytes out of framing</span>
<a name="l00811"></a>00811         uint32 m_dropped;           <span class="comment">// Number of messages dropped &amp; not delivered</span>
<a name="l00812"></a>00812         uint32 m_retries;           <span class="comment">// Number of retransmitted messages</span>
<a name="l00813"></a>00813         uint32 m_callbacks;         <span class="comment">// Number of unexpected callbacks</span>
<a name="l00814"></a>00814         uint32 m_badroutes;         <span class="comment">// Number of failed messages due to bad route response</span>
<a name="l00815"></a>00815         uint32 m_noack;             <span class="comment">// Number of no ACK returned errors</span>
<a name="l00816"></a>00816         uint32 m_netbusy;           <span class="comment">// Number of network busy/failure messages</span>
<a name="l00817"></a>00817         uint32 m_notidle;           <span class="comment">// Number of not idle messages</span>
<a name="l00818"></a>00818         uint32 m_nondelivery;           <span class="comment">// Number of messages not delivered to network</span>
<a name="l00819"></a>00819         uint32 m_routedbusy;            <span class="comment">// Number of messages received with routed busy status</span>
<a name="l00820"></a>00820         uint32 m_broadcastReadCnt;      <span class="comment">// Number of broadcasts read</span>
<a name="l00821"></a>00821         uint32 m_broadcastWriteCnt;     <span class="comment">// Number of broadcasts sent</span>
<a name="l00822"></a>00822         <span class="comment">//time_t m_commandStart;    // Start time of last command</span>
<a name="l00823"></a>00823         <span class="comment">//time_t m_timeoutLost;     // Cumulative time lost to timeouts</span>
<a name="l00824"></a>00824     };
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 } <span class="comment">// namespace OpenZWave</span>
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="preprocessor">#endif // _Driver_H</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 15 2013 16:00:17 for OpenZWave Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
